(function(root,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=factory()}else if(typeof define==="function"&&define.amd){define(factory)}else{root.DocsifyImageSize=factory()}})(typeof self!=="undefined"?self:this,function(){"use strict";function parseAltDirectives(alt){if(!alt||alt.indexOf("|")===-1){return null}const parts=alt.split("|");let size=null;let align=null;let cutIndex=parts.length;for(let i=parts.length-1;i>=1;i--){const seg=parts[i].trim();const lower=seg.toLowerCase();if(lower.indexOf("size=")===0){size=seg.slice(5).trim();cutIndex=i}else if(lower.indexOf("align=")===0){align=seg.slice(6).trim().toLowerCase();cutIndex=i}else{break}}if(!size&&!align&&alt.indexOf("|")>-1){const lowerAlt=alt.toLowerCase();if(lowerAlt.indexOf("size=")>-1||lowerAlt.indexOf("align=")>-1){if(typeof console!=="undefined"&&console&&console.warn){console.warn(`[docsify-image-size] Ignored directives in: "${alt}". Directives must be the last segments (e.g. "Alt|size=...").`)}}}if(!size&&!align){return null}const baseAlt=parts.slice(0,cutIndex).join("|").trim();return{baseAlt:baseAlt,size:size,align:align}}function sizeToStyles(size){if(!size)return{width:null,height:null,widthPercent:null};if(size.indexOf("%")!==-1){return{width:null,height:"auto",widthPercent:size}}const cleanSize=size.replace(/px/gi,"");if(/^\d+$/.test(cleanSize)){return{width:cleanSize+"px",height:"auto",widthPercent:null}}const parts=cleanSize.split(/x/i);const w=parts[0]?parts[0].trim():"auto";const h=parts[1]?parts[1].trim():"auto";const finalW=w==="auto"||/^\d+$/.test(w)?w==="auto"?"auto":w+"px":null;const finalH=h==="auto"||/^\d+$/.test(h)?h==="auto"?"auto":h+"px":null;if(!finalW&&!finalH)return{width:null,height:null,widthPercent:null};return{width:finalW||"auto",height:finalH||"auto",widthPercent:null}}function applySize(img,sizeToken){if(!sizeToken)return;const s=sizeToStyles(sizeToken);img.removeAttribute("width");img.removeAttribute("height");if(s.widthPercent){img.style.width=s.widthPercent;img.style.height="auto"}else{if(s.width)img.style.width=s.width;if(s.height)img.style.height=s.height}}function applyAlign(img,alignToken){let a=(alignToken||"left").toLowerCase();if(!["left","right","center","middle"].includes(a)){a="left"}img.setAttribute("data-img-align",a);if(!alignToken)return;img.style.display="block";img.style.marginLeft="";img.style.marginRight="";if(a==="center"||a==="middle"){img.style.marginLeft="auto";img.style.marginRight="auto"}else if(a==="right"){img.style.marginLeft="auto";img.style.marginRight="0"}else if(a==="left"){img.style.marginLeft="0";img.style.marginRight="auto"}}function parseTitleDirectives(title){if(!title)return null;const raw=title.trim();const lowerRaw=raw.toLowerCase();if(["notitle","no-title","nocaption","no_caption"].includes(lowerRaw)){return{baseTitle:"",pos:"below",style:"italic",noTitle:true}}if(raw.indexOf("|")===-1){return{baseTitle:raw,pos:"below",style:"italic",noTitle:false}}const parts=raw.split("|");const baseTitle=parts[0].trim();let pos="below";let style="italic";let noTitle=false;for(let i=1;i<parts.length;i++){const seg=parts[i].trim();const lower=seg.toLowerCase();if(["notitle","no-title","nocaption","no_caption"].includes(lower)){noTitle=true}else if(lower.startsWith("pos=")||lower.startsWith("position=")){const val=lower.split("=")[1].trim();if(["above","top"].includes(val))pos="above";if(["below","bottom"].includes(val))pos="below"}else if(lower.startsWith("style=")){const val=lower.split("=")[1].trim();if(val==="underlined")style="underline";else if(["normal","italic","bold","underline"].includes(val))style=val}}return{baseTitle:baseTitle,pos:pos,style:style,noTitle:noTitle}}function applyCaption(img,captionInfo){if(!captionInfo)return;if(captionInfo.baseTitle){img.setAttribute("title",captionInfo.baseTitle)}else{img.removeAttribute("title")}if(captionInfo.noTitle)return;if(!captionInfo.baseTitle)return;if(img.getAttribute("data-docsify-caption-added"))return;const captionEl=document.createElement("span");captionEl.textContent=captionInfo.baseTitle;captionEl.style.display="block";captionEl.style.fontSize="0.9em";captionEl.style.lineHeight="1.4";const imgAlign=img.getAttribute("data-img-align")||"left";captionEl.style.textAlign=imgAlign==="middle"?"center":imgAlign;captionEl.style.fontStyle="normal";captionEl.style.fontWeight="normal";captionEl.style.textDecoration="none";if(captionInfo.style==="bold")captionEl.style.fontWeight="bold";else if(captionInfo.style==="underline")captionEl.style.textDecoration="underline";else if(captionInfo.style==="italic")captionEl.style.fontStyle="italic";if(captionInfo.pos==="above"){captionEl.style.marginBottom="0.25rem";img.insertAdjacentElement("beforebegin",captionEl)}else{captionEl.style.marginTop="0.25rem";img.insertAdjacentElement("afterend",captionEl)}img.setAttribute("data-docsify-caption-added","true")}function imageSizePlugin(hook,vm){hook.doneEach(function(){const container=document.querySelector(".markdown-section");if(!container)return;const imgs=container.querySelectorAll("img[alt]");imgs.forEach(function(img){if(img.getAttribute("data-docsify-image-size-processed")){return}const alt=img.getAttribute("alt")||"";const altInfo=parseAltDirectives(alt);if(altInfo){img.setAttribute("alt",altInfo.baseAlt);if(altInfo.size)applySize(img,altInfo.size);applyAlign(img,altInfo.align)}else{applyAlign(img,null)}const title=img.getAttribute("title");if(title){const captionInfo=parseTitleDirectives(title);applyCaption(img,captionInfo)}img.setAttribute("data-docsify-image-size-processed","true")})})}if(typeof window!=="undefined"){window.$docsify=window.$docsify||{};window.$docsify.plugins=(window.$docsify.plugins||[]).concat(imageSizePlugin)}return imageSizePlugin});